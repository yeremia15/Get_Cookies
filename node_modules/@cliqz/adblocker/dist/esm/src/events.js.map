{"version":3,"file":"events.js","sources":["../../src/src/events.js"],"sourcesContent":["/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { queueMicrotask } from './queue-microtask';\n/**\n * Add `callback` listener for `event` in `listeners` Map.\n */\nfunction registerCallback(event, callback, listeners) {\n    let listenersForEvent = listeners.get(event);\n    if (listenersForEvent === undefined) {\n        listenersForEvent = [];\n        listeners.set(event, listenersForEvent);\n    }\n    listenersForEvent.push(callback);\n}\n/**\n * Remove `callback` listener for `event` from `listeners` Map.\n */\nfunction unregisterCallback(event, callback, listeners) {\n    const listenersForEvent = listeners.get(event);\n    if (listenersForEvent !== undefined) {\n        const indexOfCallback = listenersForEvent.indexOf(callback);\n        if (indexOfCallback !== -1) {\n            listenersForEvent.splice(indexOfCallback, 1);\n        }\n    }\n}\n/**\n * Call all registered listeners for `event` with `args` as arguments. Return\n * `true` if at least one callback was registered and `false` otherwise.\n */\nfunction triggerCallback(event, args, listeners) {\n    // Fast-path for cases where no listener is registered\n    if (listeners.size === 0) {\n        return false;\n    }\n    const listenersForEvent = listeners.get(event);\n    if (listenersForEvent !== undefined) {\n        queueMicrotask(() => {\n            for (const listener of listenersForEvent) {\n                listener(...args);\n            }\n        });\n        return true;\n    }\n    return false;\n}\n/**\n * Simple and efficient `EventEmitter` abstraction (following conventions from\n * Node.js) allowing partially typed event emitting. The set of event names is\n * specified as a type parameter while instantiating the event emitter.\n */\nexport class EventEmitter {\n    constructor() {\n        this.onceListeners = new Map();\n        this.onListeners = new Map();\n    }\n    /**\n     * Register an event listener for `event`.\n     */\n    on(event, callback) {\n        registerCallback(event, callback, this.onListeners);\n    }\n    /**\n     * Register an event listener for `event`; but only listen to first instance\n     * of this event. The listener is automatically deleted afterwards.\n     */\n    once(event, callback) {\n        registerCallback(event, callback, this.onceListeners);\n    }\n    /**\n     * Remove `callback` from list of listeners for `event`.\n     */\n    unsubscribe(event, callback) {\n        unregisterCallback(event, callback, this.onListeners);\n        unregisterCallback(event, callback, this.onceListeners);\n    }\n    /**\n     * Emit an event. Call all registered listeners to this event.\n     */\n    emit(event, ...args) {\n        triggerCallback(event, args, this.onListeners);\n        if (triggerCallback(event, args, this.onceListeners) === true) {\n            this.onceListeners.delete(event);\n        }\n    }\n}\n//# sourceMappingURL=events.js.map"],"names":[],"mappings":"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"}