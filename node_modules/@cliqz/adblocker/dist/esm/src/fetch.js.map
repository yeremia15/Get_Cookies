{"version":3,"file":"fetch.js","sources":["../../src/src/fetch.js"],"sourcesContent":["/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/**\n * Built-in fetch helpers can be used to initialize the adblocker from\n * pre-built presets or raw lists (fetched from multiple sources). In case of\n * failure (e.g. timeout), the whole process of initialization fails. Timeouts\n * are not so uncommon, and retrying to fetch usually succeeds.\n */\nexport function fetchWithRetry(fetch, url) {\n    let retry = 3;\n    // Wrap `fetch` into a lightweight retry function which makes sure that if\n    // fetching fails, it can be retried up to three times. Failure can happen if\n    // the remote server times-out, but retrying fetching of the same URL will\n    // usually succeed.\n    const fetchWrapper = () => {\n        return fetch(url).catch((ex) => {\n            if (retry > 0) {\n                retry -= 1;\n                return new Promise((resolve, reject) => {\n                    setTimeout(() => {\n                        fetchWrapper().then(resolve).catch(reject);\n                    }, 500);\n                });\n            }\n            throw ex;\n        });\n    };\n    return fetchWrapper();\n}\nfunction fetchResource(fetch, url) {\n    return fetchWithRetry(fetch, url).then((response) => response.text());\n}\nconst PREFIX = 'https://raw.githubusercontent.com/ghostery/adblocker/master/packages/adblocker/assets';\nexport const adsLists = [\n    `${PREFIX}/easylist/easylist.txt`,\n    `${PREFIX}/peter-lowe/serverlist.txt`,\n    `${PREFIX}/ublock-origin/badware.txt`,\n    `${PREFIX}/ublock-origin/filters-2020.txt`,\n    `${PREFIX}/ublock-origin/filters-2021.txt`,\n    `${PREFIX}/ublock-origin/filters-2022.txt`,\n    `${PREFIX}/ublock-origin/filters-2023.txt`,\n    `${PREFIX}/ublock-origin/filters-2024.txt`,\n    `${PREFIX}/ublock-origin/filters.txt`,\n    `${PREFIX}/ublock-origin/quick-fixes.txt`,\n    `${PREFIX}/ublock-origin/resource-abuse.txt`,\n    `${PREFIX}/ublock-origin/unbreak.txt`,\n];\nexport const adsAndTrackingLists = [\n    ...adsLists,\n    `${PREFIX}/easylist/easyprivacy.txt`,\n    `${PREFIX}/ublock-origin/privacy.txt`,\n];\nexport const fullLists = [\n    ...adsAndTrackingLists,\n    `${PREFIX}/easylist/easylist-cookie.txt`,\n    `${PREFIX}/ublock-origin/annoyances-others.txt`,\n    `${PREFIX}/ublock-origin/annoyances-cookies.txt`,\n];\n/**\n * Fetch latest version of enabledByDefault blocking lists.\n */\nexport function fetchLists(fetch, urls) {\n    return Promise.all(urls.map((url) => fetchResource(fetch, url)));\n}\n/**\n * Fetch latest version of uBlock Origin's resources, used to inject scripts in\n * the page or redirect request to data URLs.\n */\nexport function fetchResources(fetch) {\n    return fetchResource(fetch, `${PREFIX}/ublock-origin/resources.txt`);\n}\n//# sourceMappingURL=fetch.js.map"],"names":[],"mappings":"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"}