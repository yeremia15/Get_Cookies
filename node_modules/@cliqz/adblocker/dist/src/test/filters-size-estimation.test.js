/*!
 * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
import { expect } from 'chai';
import 'mocha';
import { StaticDataView } from '../src/data-view';
import { parseFilters } from '../src/lists';
import { allLists } from './utils';
describe('Make sure size estimate is accurate', () => {
    const { cosmeticFilters, networkFilters } = parseFilters(allLists, { debug: true });
    function testSizeEstimate(filters, compression) {
        const buffer = StaticDataView.allocate(1000000, { enableCompression: compression });
        for (let i = 0; i < filters.length; i += 1) {
            const filter = filters[i];
            const estimate = filter.getSerializedSize(compression);
            // Serialize filter
            buffer.seekZero();
            filter.serialize(buffer);
            const realSize = buffer.pos;
            if (estimate !== realSize) {
                expect(estimate, filter.toString()).to.equal(realSize);
            }
        }
    }
    it('network', () => {
        testSizeEstimate(networkFilters, false);
    });
    it('network (compression)', () => {
        testSizeEstimate(networkFilters, true);
    });
    it('cosmetic', () => {
        testSizeEstimate(cosmeticFilters, false);
    });
    it('cosmetic (compression)', () => {
        testSizeEstimate(cosmeticFilters, true);
    });
});
//# sourceMappingURL=filters-size-estimation.test.js.map